
import org.apache.commons.compress.archivers.tar.*;

buildscript{
	repositories{
		mavenCentral()
	}
    dependencies{
        classpath localGroovy()
        classpath 'org.apache.commons:commons-compress:1.11'
    }
}

repositories{
	mavenCentral()
}

apply plugin: 'java'

def taskgroup="avnav"
['build','clean'].each { tt ->
    tasks.create(name:"${tt}Android",type: GradleBuild) {
        group taskgroup
        setDir("android")
        setTasks([tt])
    }
}
clean.dependsOn cleanAndroid
build.dependsOn buildAndroid

["debug","release","clean"].each { tt ->
    def vt=tasks.create(name: "${tt}Viewer",type: GradleBuild) {
        group taskgroup
        setDir("viewer")
        setTasks([tt])
    }
    if (tt == "clean"){
        clean.dependsOn vt
    }
    else{
        build.dependsOn vt
    }
}



task releaseTar(type: ExtendedTar){
    from ("viewer/build/release") {
        into "viewer"
    }
    from ("server"){
        into "server"
        include("*py")
    }
    ofile="$buildDir/test.tar"
    modifyEntry {
        TarArchiveEntry entry, FileCopyDetails details ->
            entry.setGroupId(1000)
            entry.setUserId(1000)
            def name=details.getName()
            def isDir=details.isDirectory()
            if (name.endsWith(".py") || name.endsWith(".sh") || isDir){
                entry.setMode(0755)
            }
            else{
                entry.setMode(0644)
            }
            println "adding "+entry.getName()
            return true
    }
}


